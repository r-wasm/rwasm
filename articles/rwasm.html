<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get started with rwasm • rwasm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get started with rwasm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rwasm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rwasm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/github-actions.html">Build R packages using GitHub Actions</a></li>
    <li><a class="dropdown-item" href="../articles/mount-fs-image.html">Mounting filesystem images</a></li>
    <li><a class="dropdown-item" href="../articles/mount-host-dir.html">Mounting host directories in node</a></li>
    <li><a class="dropdown-item" href="../articles/tar-metadata.html">Technical details for .tar archive metadata</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-wasm/rwasm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Get started with rwasm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-wasm/rwasm/blob/main/vignettes/rwasm.Rmd" class="external-link"><code>vignettes/rwasm.Rmd</code></a></small>
      <div class="d-none name"><code>rwasm.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="compiling-r-packages-for-webassembly">Compiling R packages for WebAssembly<a class="anchor" aria-label="anchor" href="#compiling-r-packages-for-webassembly"></a>
</h2>
<p>Building binary R packages for WebAssembly (Wasm) requires
cross-compiling packages containing C/C++/Fortran source code using a
Wasm development toolchain. As such, the <a href="https://emscripten.org" class="external-link">Emscripten</a> C/C++ toolchain and a <a href="https://github.com/lionel-/f18-llvm-project/tree/fix-webr" class="external-link">version
of LLVM <code>flang</code> configured to output Wasm</a> must be
available in the environment for the <code>rwasm</code> package to
function.</p>
<p>There are two supported ways to ensure that the required environment
and toolchain is available. Either install and build a local <a href="https://github.com/r-wasm/webr" class="external-link">development build of webR</a>, or
use the <code>rwasm</code> package inside a pre-prepared Docker
container to build Wasm R packages.</p>
</div>
<div class="section level2 tabset">
<h2 class="tabset" id="setting-up-the-webassembly-toolchain">Setting up the WebAssembly toolchain<a class="anchor" aria-label="anchor" href="#setting-up-the-webassembly-toolchain"></a>
</h2>


<ul class="nav nav-tabs" id="setting-up-the-webassembly-toolchain" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#using-the-webr-docker-container" id="using-the-webr-docker-container-tab" type="button" role="tab" aria-controls="using-the-webr-docker-container" aria-selected="true" class="active nav-link">Using the webR Docker container</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#webr-development-installation" id="webr-development-installation-tab" type="button" role="tab" aria-controls="webr-development-installation" aria-selected="false" class="nav-link">WebR development installation</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="using-the-webr-docker-container" role="tabpanel" aria-labelledby="using-the-webr-docker-container-tab">

<p>First, ensure that <a href="https://www.docker.com" class="external-link">Docker</a> is
installed on your machine<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;For macOS machines with Apple Silicon processors, ensure
that “Use Rosetta for x86/amd64 emulation on Apple Silicon” is disabled
in the Docker Desktop settings.&lt;/p&gt;"><sup>1</sup></a>. Then, in a terminal, pull the latest
version of the <a href="https://github.com/r-wasm/webr/pkgs/container/webr" class="external-link">webR
development container</a>:</p>
<pre class="console"><code>docker pull ghcr.io/r-wasm/webr:main</code></pre>
<p>Next, create a new directory named <code>output</code> to store the
built R packages,</p>
<pre class="console"><code>mkdir -p output</code></pre>
<p>Then start R in the Docker container, mounting the new
<code>output</code> directory into place and setting it as the working
directory<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If you see an error along the lines of
&lt;code&gt;The path [...]/output is not shared from the host and is not known to Docker&lt;/code&gt;,
follow the instructions given in the rest of the error output to ensure
that the &lt;code&gt;output&lt;/code&gt; directory is shared with Docker.&lt;/p&gt;"><sup>2</sup></a>:</p>
<pre class="console"><code>docker run -it --rm -v ${PWD}/output:/output -w /output ghcr.io/r-wasm/webr:main R</code></pre>
<p>You may now continue by working in this R session. The Docker
container will provide the required development environment and tools
for building binary R packages for Wasm. R packages and repositories
built in this way will be written in the directory
<code>output</code>.</p>
</div>
<div class="tab-pane" id="webr-development-installation" role="tabpanel" aria-labelledby="webr-development-installation-tab">

<p>Note that building webR from source takes a long time and a lot of
disk space, mostly due to the requirement of building LLVM
<code>flang</code> from source.</p>
<p>Follow <a href="https://github.com/r-wasm/webr#building-webr-from-source" class="external-link">the webR
build instructions</a> to download and build webR from source. If you
are planning to build R packages that depend on system libraries, ensure
that you also perform the optional step to additionally build all
WebAssembly libraries.</p>
<p>Once webR has been built, we need to configure your environment so
that the native R process can find your webR development installation.
Make a note of your webR development directory and your Emscripten
installation directory<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;If you are using &lt;a href="https://github.com/emscripten-core/emsdk" class="external-link"&gt;emsdk&lt;/a&gt; to manage your
Emscripten installation the &lt;code&gt;EMSDK&lt;/code&gt; environment variable
should already be in place. In that case you may skip setting
&lt;code&gt;EMSCRIPTEN_ROOT&lt;/code&gt;.&lt;/p&gt;'><sup>3</sup></a>.</p>
<p>Edit or create the file <code>~/.webr-vars.mk</code>, and ensure it
contains the following lines, replacing the values with your own
installation directories:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="dt">WEBR_ROOT</span><span class="ch">=</span><span class="st">/home/username/webr</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="dt">EMSCRIPTEN_ROOT</span><span class="ch">=</span><span class="st">/home/username/emsdk/upstream/emscripten</span></span></code></pre></div>
<p>The settings above can also be made available to R by exporting them
as environment variables.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="installing-the-rwasm-package">Installing the <code>rwasm</code> package<a class="anchor" aria-label="anchor" href="#installing-the-rwasm-package"></a>
</h2>
<p>The <code>rwasm</code> package builds R binary packages for
WebAssembly, organising the output into CRAN-like repositories. The <a href="https://pak.r-lib.org" class="external-link">pak</a> package can be used to install
<code>rwasm</code> from GitHub.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"r-wasm/rwasm"</span><span class="op">)</span></span></code></pre></div>
<p>Once installed, load the <code>rwasm</code> package. If
<code>rwasm</code> is able to find the Wasm development environment, it
will print the directories it discovered and the version of webR that it
is targeting. This might be different to the version of R installed on
your native system.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-wasm.github.io/rwasm/">rwasm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Targeting Wasm packages for R 4.3.0</span></span>
<span><span class="co">#&gt; With `WEBR_ROOT` directory: /opt/webr</span></span>
<span><span class="co">#&gt; With `EMSCRIPTEN_ROOT` directory: /opt/emsdk/upstream/emscripten</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-an-r-package">Building an R package<a class="anchor" aria-label="anchor" href="#building-an-r-package"></a>
</h2>
<p>R package binaries can be built for WebAssembly using the
<code><a href="../reference/build.html">build()</a></code> function. The resulting Wasm R package binary and
an Emscripten filesystem image containing the R package are written to
the directory given by the <code>out_dir</code> argument, defaulting to
the current working directory.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/build.html">build</a></span><span class="op">(</span><span class="st">"cli"</span><span class="op">)</span></span></code></pre></div>
<p>Wasm R package binaries must be made available to the webR filesystem
in some way before they can be used. Read on for more details on how to
build an R package library for static web hosting of Wasm R packages.
Alternatively, see <code>vignette("mount-fs-image.Rmd")</code> for
details on how to mount Emscripten filesystem images.</p>
</div>
<div class="section level2">
<h2 id="adding-an-r-package-to-a-package-repository">Adding an R package to a package repository<a class="anchor" aria-label="anchor" href="#adding-an-r-package-to-a-package-repository"></a>
</h2>
<p>Use <code><a href="../reference/add_pkg.html">add_pkg()</a></code> to build an R package (along with its
dependencies) for Wasm and add it to an R package repository. A new
directory named <code>repo</code> will be created for the repository if
it does not already exist, otherwise the existing repository will be
updated to include the new package. By default, hard package
dependencies will also be built for Wasm and added to the
repository.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_pkg.html">add_pkg</a></span><span class="op">(</span><span class="st">"cli"</span><span class="op">)</span></span></code></pre></div>
<p>See the <code><a href="https://r-lib.github.io/pkgdepends/reference/pkg_refs.html" class="external-link">?pkgdepends::pkg_refs</a></code> article to see which kind
of package references can be used to add packages to the repository.</p>
</div>
<div class="section level2">
<h2 id="managing-and-using-the-repository">Managing and using the repository<a class="anchor" aria-label="anchor" href="#managing-and-using-the-repository"></a>
</h2>
<p>The CRAN-like R package repository in the output directory
<code>repo</code> should be hosted by a web server so that it is
available at some URL. Such a URL can then be passed to
<code>webr::install()</code> as a repository from which to install Wasm
R packages.</p>
<div class="section level3">
<h3 id="local-testing">Local testing<a class="anchor" aria-label="anchor" href="#local-testing"></a>
</h3>
<p>The R command given below starts a local web server to serve your
package repository for testing<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Ensure that the latest version of the
&lt;code&gt;httpuv&lt;/code&gt; package is installed so that the
&lt;code&gt;?httpuv::runStaticServer&lt;/code&gt; function is available.&lt;/p&gt;"><sup>4</sup></a>. The
<code>Access-Control-Allow-Origin: *</code> HTTP header is included,
required for loading R packages from a cross-origin server through the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" class="external-link">CORS</a>
mechanism.</p>
<p>If you are using a Docker container to build Wasm R packages, be sure
to run the following command in a new R session outside Docker so that
the web server is accessible to the host machine. You might also want to
set <code>dir = "./output"</code> to serve the contents of the
<code>output</code> directory mounted in the Docker container.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">httpuv</span><span class="fu">::</span><span class="fu">runStaticServer</span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">9090</span>,</span>
<span>  browse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Access-Control-Allow-Origin"</span> <span class="op">=</span>  <span class="st">"*"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once the web server is running start a webR session in your browser,
such as the console at <a href="https://webr.r-wasm.org/latest/" class="external-link uri">https://webr.r-wasm.org/latest/</a>. Install a package from
your local repository using your test server URL as the
<code>repos</code> argument<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;You might need to adjust the path portion of the URL,
depending on your set-up. If it does not work, you could also try
&lt;code&gt;"http://127.0.0.1:9090"&lt;/code&gt; or
&lt;code&gt;"http://127.0.0.1:9090/output/repo"&lt;/code&gt;&lt;/p&gt;'><sup>5</sup></a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">webr</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"cli"</span>, repos <span class="op">=</span> <span class="st">"http://127.0.0.1:9090/repo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading webR package: cli</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="deployment-to-static-hosting">Deployment to static hosting<a class="anchor" aria-label="anchor" href="#deployment-to-static-hosting"></a>
</h3>
<p>Once you are happy that your R package repository is working and
sufficient, it should be deployed to the web via a static file hosting
service of your choice. In this example we will use GitHub Pages.</p>
<p>First, create a new directory for your GitHub repository and copy
your webR binary repo into place.</p>
<pre><code>mkdir -p my-wasm-repo
cp -r ./path/to/output/repo my-wasm-repo/repo
cd my-wasm-repo</code></pre>
<p>Next, initialise a new GitHub repository to host your binary R
packages, and run the commands given by GitHub to initialise and push an
initial commit of your Wasm binary packages.</p>
<pre><code>git init
git add repo
git commit -m "First commit"
git branch -M main
git remote add origin https://github.com/username/my-wasm-repo.git
git push -u origin main</code></pre>
<p>Now, in your web browser, refresh your GitHub project and click
<strong>Settings</strong>. If you cannot see the “Settings” tab, click
the dropdown menu, then click <strong>Settings</strong>.</p>
<p><img src="images/settings.png" alt="Screenshot of the GitHub repository heading bar, with the Settings link highlighted." width="100%"></p>
<p>In the “Code and automation” section of the sidebar, click
<strong>Pages</strong>.</p>
<p>Under “Build and deployment”, under “Source”, select <strong>Deploy
from a branch</strong>.</p>
<p>Under “Branch”, use the branch dropdown menu and select
<strong>main</strong> as the publishing source, then click
<strong>Save</strong>.</p>
<p><img src="images/deploy.png" alt="Screenshot of the GitHub settings page for a repository. Under Code and automation, the Pages link is highlighted. Under Build and deployment, the Deploy from a branch setting is selected for the Source setting and highlighted. Under branch, main is selected as the publishing source and highlighted." width="100%"></p>
<p>GitHub will then start to prepare your GitHub Pages site to contain
your CRAN-like Wasm package repository.</p>
<p>After a little while<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;You should be able to see progress of the website build
step in the &lt;strong&gt;Actions&lt;/strong&gt; section of your GitHub project.&lt;/p&gt;"><sup>6</sup></a>, your GitHub Pages website will be ready
and webR should be able to install your package from the GitHub Pages
repo URL.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">webr</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"cli"</span>, repos <span class="op">=</span> <span class="st">"http://username.github.io/my-wasm-repo/repo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading webR package: cli</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Stagg, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
